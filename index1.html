<!DOCTYPE html>
<html>
<head>
    <title>Leaflet and D3 Map</title>
    <meta charset="utf-8" />
    <link 
        rel="stylesheet" 
        href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css"
    />

</head>
<body>

    <div id="map" style="width: 600px; height: 400px"></div>

	<script src="http://d3js.org/d3.v3.js"></script>

    <script
        src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js">
    </script>

    <script>
	
        var map = L.map('map').setView([-41.2858, 174.7868], 13);
        mapLink = 
            '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; ' + mapLink + ' Contributors',
            maxZoom: 18,
            }).addTo(map);

		// Add an SVG element to Leafletâ€™s overlay pane
		var svg = d3.select(map.getPanes().overlayPane).append("svg"),
			g = svg.append("g").attr("class", "leaflet-zoom-hide");
			
		d3.json("special.json", function(geoShape) {
		
		//  create a d3.geo.path to convert GeoJSON to SVG
		var transform = d3.geo.transform({point: projectPoint}),
            	path = d3.geo.path().projection(transform);
 
 
		//inject external fragments of svg
		//g.append("path")
		//	.attr({
		//		"d":"M207,170c-0.5,0,-0.5,0,-1,0c-1,-0.5,-1,-0.5,-2,-1c-1.5,0,-1.5,0,-3,0c-3,-1,-3,-1,-6,-2c-1.5,0,-1.5,0,-3,0c-1,-0.5,-1,-0.5,-2,-1c-1.5,0,-1.5,0,-3,0c-3,-1,-3,-1,-6,-2c-1.5,0,-1.5,0,-3,0c-2,-1,-2,-1,-4,-2c-1,0,-1,0,-2,0c-1,-1,-1,-1,-2,-2c-1,0,-1,0,-2,0c-0.5,-1,-0.5,-1,-1,-2c-2,-1,-2,-1,-4,-2c-0.5,-1,-0.5,-1,-1,-2c-1,-0.5,-1,-0.5,-2,-1c-3.5,-3.5,-3.5,-3.5,-7,-7c-0.5,-1,-0.5,-1,-1,-2c-0.5,-0.5,-0.5,-0.5,-1,-1c-0.5,-1,-0.5,-1,-1,-2c-1,-1,-1,-1,-2,-2c0,-0.5,0,-0.5,0,-1c-0.5,-0.5,-0.5,-0.5,-1,-1c0,-0.5,0,-0.5,0,-1c-0.5,-0.5,-0.5,-0.5,-1,-1c0,-10,0,-10,0,-20c0.5,-1,0.5,-1,1,-2c0,-1,0,-1,0,-2c1,-2,1,-2,2,-4c1.5,-1.5,1.5,-1.5,3,-3c1,-0.5,1,-0.5,2,-1c0,-0.5,0,-0.5,0,-1c1,-0.5,1,-0.5,2,-1c1,0,1,0,2,0c2,-1,2,-1,4,-2c0.5,0,0.5,0,1,0c1,-0.5,1,-0.5,2,-1c7.5,0,7.5,0,15,0c0.5,0.5,0.5,0.5,1,1c1.5,0,1.5,0,3,0c0,0.5,0,0.5,0,1c1,0.5,1,0.5,2,1c0.5,0.5,0.5,0.5,1,1c1,0.5,1,0.5,2,1c0,0.5,0,0.5,0,1c1,0.5,1,0.5,2,1c0,0.5,0,0.5,0,1c1,0.5,1,0.5,2,1c0.5,0.5,0.5,0.5,1,1c0.5,0,0.5,0,1,0c0.5,1,0.5,1,1,2c0.5,0.5,0.5,0.5,1,1c1,0.5,1,0.5,2,1c0.5,1,0.5,1,1,2c1,0.5,1,0.5,2,1c0,0.5,0,0.5,0,1c1,0.5,1,0.5,2,1c0,0.5,0,0.5,0,1c1,0,1,0,2,0c0,1,0,1,0,2c2,1,2,1,4,2c0.5,0.5,0.5,0.5,1,1c0,0.5,0,0.5,0,1c0.5,0,0.5,0,1,0c0.5,0.5,0.5,0.5,1,1c3,0,3,0,6,0c1,-0.5,1,-0.5,2,-1c0.5,-0.5,-127.5,80.5,1,-1c0.5,0,0.5,0,1,0c1,-1,1,-1,2,-2c0.5,0,0.5,0,1,0c0.5,-1,0.5,-1,1,-2c0.5,-0.5,0.5,-0.5,1,-1c0.5,0,0.5,0,1,0c0.5,-1,0.5,-1,1,-2c0.5,0,0.5,0,1,0c0,-0.5,0,-0.5,0,-1c1,-1,1,-1,2,-2c0.5,0,0.5,0,1,0c0,-0.5,0,-0.5,0,-1c0.5,-0.5,0.5,-0.5,1,-1c1,-0.5,1,-0.5,2,-1c0.5,-0.5,0.5,-0.5,1,-1c0,-0.5,0,-0.5,0,-1c0.5,-0.5,0.5,-0.5,1,-1c1,-0.5,1,-0.5,2,-1c0.5,-0.5,0.5,-0.5,1,-1c1,0,1,0,2,0c1,-1,1,-1,2,-2c1.5,-0.5,1.5,-0.5,3,-1c2,-1,2,-1,4,-2c1,0,1,0,2,0c1,-0.5,1,-0.5,2,-1c0.5,-0.5,0.5,-0.5,1,-1c12,0,12,0,24,0c0.5,0.5,0.5,0.5,1,1c1.5,0,1.5,0,3,0c0.5,0.5,0.5,0.5,1,1c0,0.5,0,0.5,0,1c1,0,1,0,2,0c0,1,0,1,0,2c1,0,1,0,2,0c0,1,0,1,0,2c1,0.5,1,0.5,2,1c0,0.5,0,0.5,0,1c1.5,3,1.5,3,3,6c0,1,0,1,0,2c0.5,0.5,0.5,0.5,1,1c0,9.5,0,9.5,0,19c-0.5,0.5,-0.5,0.5,-1,1c-1,0,-1,0,-2,0c-1,0.5,-1,0.5,-2,1c-2,0,-2,0,-4,0c-1,0.5,-1,0.5,-2,1c-7,0,-7,0,-14,0c-1,-0.5,-1,-0.5,-2,-1c-2,0,-2,0,-4,0c-0.5,-0.5,-0.5,-0.5,-1,-1c-1.5,0,-1.5,0,-3,0c-0.5,-0.5,-0.5,-0.5,-1,-1c-3,0,-3,0,-6,0c-0.5,-0.5,-0.5,-0.5,-1,-1c-6.5,0,-6.5,0,-13,0c-0.5,0.5,-0.5,0.5,-1,1c-0.5,0,-0.5,0,-1,0c0,0.5,0,0.5,0,1c-0.5,0,-0.5,0,-1,0c0,1,0,1,0,2c-0.5,0.5,-0.5,0.5,-1,1c0,3.5,0,3.5,0,7c0.5,1,0.5,1,1,2c0,1,0,1,0,2c1,1,1,1,2,2c0,0.5,0,0.5,0,1c1.5,1.5,1.5,1.5,3,3c0.5,0.5,0.5,0.5,1,1c1,0.5,1,0.5,2,1c0,0.5,0,0.5,0,1c0.5,0,0.5,0,1,0c0.5,0.5,0.5,0.5,1,1c0.5,0,0.5,0,1,0c0.5,1,0.5,1,1,2c0.5,0,0.5,0,1,0c1,0.5,1,0.5,2,1c0,0.5,0,0.5,0,1c1,0,1,0,2,0c0.5,0.5,0.5,0.5,1,1c1,0.5,1,0.5,2,1c1.5,0,1.5,0,3,0c0,0.5,0,0.5,0,1c0.5,0,0.5,0,1,0c1,0.5,1,0.5,2,1c10.5,0,10.5,0,21,0c2,-1,2,-1,4,-2c1,0,1,0,2,0c1.5,-0.5,1.5,-0.5,3,-1c4,-2,4,-2,8,-4c1,0,1,0,2,0c1,-0.5,1,-0.5,2,-1c1,0,1,0,2,0c1.5,-0.5,1.5,-0.5,3,-1c1,-0.5,1,-0.5,2,-1c3.5,0,3.5,0,7,0c1,1,1,1,2,2c0,0.5,0,0.5,0,1c1,0.5,1,0.5,2,1c0.5,0.5,0.5,0.5,1,1c0,0.5,0,0.5,0,1c1,1,1,1,2,2c0,3.5,0,3.5,0,7c-1.5,1.5,-1.5,1.5,-3,3c-0.5,0,-0.5,0,-1,0c-1,0.5,-1,0.5,-2,1c-0.5,0.5,-0.5,0.5,-1,1c-1,0,-1,0,-2,0c-2,1,-2,1,-4,2c-1.5,0,-1.5,0,-3,0c-1,0.5,-1,0.5,-2,1c-3,0,-3,0,-6,0c-1,0.5,-1,0.5,-2,1c-2,0,-2,0,-4,0c-1,0.5,-1,0.5,-2,1c-1,0,-1,0,-2,0c-1,0.5,-1,0.5,-2,1c-8.5,0,-8.5,0,-17,0c-1,0.5,-1,0.5,-2,1c-1,0,-1,0,-2,0c-1,0.5,-1,0.5,-2,1c-2,0,-2,0,-4,0c-1,0.5,-1,0.5,-2,1c-3.5,0,-3.5,0,-7,0c-1,0.5,-1,0.5,-2,1c-2,0,-2,0,-4,0c-0.5,0.5,-0.5,0.5,-1,1c-6,0,-6,0,-12,0c-0.5,-0.5,-0.5,-0.5,-1,-1c-1.5,0,-1.5,0,-3,0c0,-0.5,0,-0.5,0,-1c-0.5,0,-0.5,0,-1,0c-0.5,-0.5,-0.5,-0.5,-1,-1c-0.5,0,-0.5,0,-1,0c0,-0.5,0,-0.5,0,-1c-0.5,0,-0.5,0,-1,0c-0.5,-0.5,-0.5,-0.5,-1,-1c-1,-0.5,-1,-0.5,-2,-1c-2,-2,-2,-2,-4,-4c-0.5,0,-0.5,0,-1,0c0,-0.5,0,-0.5,0,-1c-0.5,0,-0.5,0,-1,0c-0.5,-0.5,-0.5,-0.5,-1,-1c-0.5,0,-0.5,0,-1,0c0,-0.5,0,-0.5,0,-1c-1,-1,-1,-1,-2,-2c-1,0,-1,0,-2,0c-1,-0.5,-1,-0.5,-2,-1c-0.5,0,-0.5,0,-1,0c0,-0.5,0,-0.5,0,-1c-1,0,-1,0,-2,0c-0.5,-0.5,-0.5,-0.5,-1,-1c-2.5,0,-2.5,0,-5,0c0,-0.5,0,-0.5,0,-1c-0.5,-0.5,-0.5,-0.5,-1,-1c0,-0.5,0,-0.5,0,-1c-1,0,-1,0,-2,0",
		//		"stroke":"black",
		//		"id":"e144_freepath",
		//		"stroke-width":"1", 
		//		"fill":"skyblue"
		//	});
 
		// create path elements for each of the features
		//d3_features = g.selectAll("path")
		//	.data(geoShape.features)
		//	.enter().append("path");
			
		var gAll = g.selectAll("path");
		
		var dataGS = gAll.data(geoShape.features);
		var dEnter = dataGS.enter();
		d3_features = dEnter.append("path")
		.style("fill",function (d,i){
		return d.properties.fill
		});

		map.on("viewreset", reset);

		reset();

		// fit the SVG element to leaflet's map layer
		function reset() {
        
			bounds = path.bounds(geoShape);

			var topLeft = bounds[0],
				bottomRight = bounds[1];

			svg .attr("width", bottomRight[0] - topLeft[0])
				.attr("height", bottomRight[1] - topLeft[1])
				.style("left", topLeft[0] + "px")
				.style("top", topLeft[1] + "px");

			g .attr("transform", "translate(" + -topLeft[0] + "," 
			                                  + -topLeft[1] + ")");

			// initialize the path data	
			d3_features.attr("d", path)
				.style("fill-opacity", 0.7)
				.attr('fill','blue');
		} 

		// Use Leaflet to implement a D3 geometric transformation.
		function projectPoint(x, y) {
			var point = map.latLngToLayerPoint(new L.LatLng(y, x));
			this.stream.point(point.x, point.y);
		}

	})
        
    </script>
</body>
</html>