<!DOCTYPE html>
<html>
<head>
    <title>Leaflet and D3 Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src="js/jscolor.js"></script>
    <script src="js/config.js"></script>

<style>
html, body, #mapsWrapper { width:100%; height:800px; margin:0; padding:0; }
.menu {font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif; border-radius: 4px; box-shadow: 0px 0px 7px #888888; padding: 4px 5.5px; background-color: white; opacity:0.85;}
.item_selector {float: left; margin: 0 2px; font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif; border-radius: 4px; padding: 4px 5.5px; background-color: white; opacity:1;}
.menu:hover{background-color: #f4f4f4; opacity:1;}

#vars_btn {position:absolute; top: 100px; left: 10px;}
#vars_panel{position: absolute; padding: 5px; top: 100px; left: 45px; width:130px; background-color: white; display:none;}

#conf_btn {position:absolute; top: 300px; left: 10px;}
#conf_panel{position: absolute; padding: 5px; top: 300px; left: 45px; width:180px; background-color: white; display:none;}

#webservice_btn {position:absolute; top: 330px; left: 10px;}
#webservice_panel{position: absolute; padding: 5px; top: 300px; left: 45px; width:180px; background-color: white; display:none;}

#download_btn {position:absolute; top: 360px; left: 10px;}
#download_panel{position: absolute; padding: 5px; top: 300px; left: 45px; width:180px; background-color: white; display:none;}

#first_menu {position: absolute; top: 80px; left: 10px;}
#date_selector{position: absolute; top: 10px; right: 500px;}

.wsvar{background-color: #f6f6f6; text-align: center; cursor:pointer}
.wsvar:hover{background-color: #bfc8d6}
</style>
</head>
<body>
    <div id="mapsWrapper" style="height: 480px; width:800px"></div>

	<script src="http://d3js.org/d3.v3.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <script>


	
var map;

fnLoadMaps();

function fnLoadMaps(){
    var fixedGeoShape,transform,path;

    map = L.map('mapsWrapper', {fullscreenControl: true}).setView([28,-93], 7);
    
    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 9,
        minZoom: 6
    }).addTo(map);
    
	//Create a d3.geo.path to convert GeoJSON to SVG
	d3.json("special.json_alex", function(geoShape) {
		transform = d3.geo.transform({point: projectPoint}),
		path = d3.geo.path().projection(transform),
		fixedGeoShape = geoShape;
	});

//$.getJSON('special.json_alex', function (data) {
//    // Define the geojson layer and add it to the map
//    L.geoJson(data).addTo(map);
//});


    //Import the SVG
//    d3.xml("salt_temp_speed_bathy.svg", "image/svg+xml", function(svgImg) {
    d3.xml("20161104_00_unknown.svg", "image/svg+xml", function(svgImg) {
         map.getPanes().overlayPane.appendChild(svgImg.documentElement);
         map.on("viewreset", reset);
         reset();
         
         function reset() {
              bounds = path.bounds(fixedGeoShape);
            var topLeft = bounds[0], bottomRight = bounds[1];
            var WW=bottomRight[0] - topLeft[0];
            var HH=bottomRight[1] - topLeft[1];
//            alert(WW+'----'+HH);
			$("svg")
				.attr("width",bottomRight[0] - topLeft[0])
				.attr("height",HH)
				.css({"left":topLeft[0], "top":topLeft[1]});
//        show_only('salt');
        //update_vars();
        update_view();

        after_svg_tasks();
        }
    });


}

// Use Leaflet to implement a D3 geometric transformation.
function projectPoint(x, y) {
	var point = map.latLngToLayerPoint(new L.LatLng(y, x));
	this.stream.point(point.x, point.y);
}

function show_hide(what){
  var ids="[id*="+what+"]";
  var opac=$(ids).css('opacity');

  if (opac==1){
    $(ids).css({'opacity':0});
  }else{
    $(ids).css({'opacity':1});
//	update_vars();
  }
}

function update_view(){
  show_hide_vfield('currents');
  show_hide_vfield('wind');
  show_hide_isobaths();
}


function show_hide_river(){
  var show=$('#checkboxRiver').prop('checked');
  if (show==false){
    $('#rivDiv').css({'opacity':0});
  }else{
    $('#rivDiv').css({'opacity':0.9});
  }

  // remove this from here when river is not inside <object>!
  if (rivDefaults){
    choose_riv(rivDefaults[0],rivDefaults[1]);
    rivDefaults=0;
  }
}

function show_hide_vfield(what){

  if (what=='currents'){
    var show=$('#checkboxCurrents').prop('checked');
  }else if (what=='wind'){
    var show=$('#checkboxWind').prop('checked');
  }

  if (show==false){
    // vfield:
    $("[id*="+what+"_]").css({'opacity':0});
    // scale:
    $("#"+what+"SvgScale").css({'opacity':0});
    $("#"+what+"SvgScale0").css({'opacity':0});
  }else{
    update_vfield(what);
  }
}

function get_zoom(){
  var Zmin=7;
  var Zmax=9;
  var zoom=map.getZoom();
  zoom = zoom<=Zmin ? Zmin:zoom;
  zoom = zoom>=Zmax ? Zmax:zoom;
  return zoom
}

function update_vfield(what){
  // vectors to show and lw according to zoom

  var zoom=get_zoom();

  // vfield line width:
  var lwMax=0.7;
  if (zoom==7){
    var lw=lwMax;
  }else{
    var lw=lwMax/Math.pow(2,zoom-7)
  }


  // 1st hide all vfields:
  $("[id*="+what+"_]").css({'opacity':0});

  // now show for current zoom:
  $("#"+what+"_"+zoom).css({'opacity':1});
  // scale:
  $("#"+what+"SvgScale0").css({'opacity':0.8});
  $("#"+what+"SvgScale").css({'opacity':1});

  // set lw:
  $("[id*="+what+"_"+zoom+"]").children().css({"stroke-width":lw});

  // show aux scale:
  //$("#"+what+"_"+zoom+"_scale").css({'opacity':1});

  // update scale:
  if (what=='currents'){
    update_currents_scale(zoom);
  }else if (what=='wind'){
    update_wind_scale(zoom);
  }
}

function show_hide_isobaths(){
  var show=$('#checkboxBathy').prop('checked');
  if (show==false){
    // vfield:
    $("[id*=bathy_]").css({'opacity':0});
  }else{
    update_isobaths();
  }
}

function update_isobaths(){
  // isobaths to show, lw and fs according to zoom
  var zoom=get_zoom();

  // line width:
  var lwMax=0.7;
  if (zoom==7){
    var lw=lwMax;
  }else{
    var lw=lwMax/Math.pow(2,zoom-7)
  }

  // font size and circle r:
  if (zoom==7){
    var fs=6;
    var rr=0.6;
  }else if (zoom==8){
    var fs=3.5;
    var rr=0.4;
  }else if (zoom==9){
    var fs=2;
    var rr=0.2;
  }


  // hide all:
  $("[id*=_bathy_]").css({'opacity':0});
  // show for current zoom:
  $("[id*=h_bathy_"+zoom+"]").css({"opacity":1});
  $("[id*=h_bathy_"+zoom+"]").children().css({"stroke-width":lw,'opacity':1});
  $("[id*=clab1_bathy_"+zoom+"]").css({"opacity":1});
  $("[id*=clab2_bathy_"+zoom+"]").css({"opacity":1});

  // update circle radius:
  $("[id*=clab2_bathy_"+zoom+"]").children('defs').children('circle').attr('r',rr);

  // clabels font size:
  $("[id*=clab1_bathy_"+zoom+"]").children().css({'font-size':fs});
  $("[id*=clab1_bathy_"+zoom+"]").children().children().css({'font-size':fs});
}

function svg_scale(){
  var o=$('svg')[0]
  var w=$(o).attr('width');
  var h=$(o).attr('height');
  var W=$(o).attr('viewBox').split(' ')[2];
  var H=$(o).attr('viewBox').split(' ')[3];
  //var H=o.getBoundingClientRect()['height'];
  //var W=o.getBoundingClientRect()['width'];
  return r=(h/H+w/W)/2;
}

function update_currents_scale(zoom){
  var ob=document.getElementById('currents_'+zoom+'_scale');
  var L=ob.getBoundingClientRect()['width'];
  var p=seta(0,10,L,0);
  pts='';
  for (var i=0; i<p.length; i++){
    pts+=p[i][0]+','+p[i][1]+' ';
  }

  $('#currentsScale').attr('points',pts);
  // center arrow:
  var arrowStart=40-L/2;
  $('#currentsScale').attr('transform','scale(1) translate('+arrowStart+',0)');

  // update lw:
  var lw=parseFloat($(ob).children('path').css('stroke-width').replace('px',''));
  $('#currentsScale').css({'stroke-width':lw*svg_scale()})
}

function update_wind_scale(zoom){
  var ob=document.getElementById('wind_'+zoom+'_scale');
  var L=ob.getBoundingClientRect()['width'];
  var p=seta2d(0,12,L,0);
  pts='';
  for (var i=0; i<p.length; i++){
    pts+=p[i][0]+','+p[i][1]+' ';
  }

  $('#windScale').attr('points',pts);
  // center arrow:
  var arrowStart=40-L/2;
  $('#windScale').attr('transform','scale(1) translate('+arrowStart+',0)');

  // update lw:
  var lw=parseFloat($(ob).children('path').css('stroke-width').replace('px',''));
  $('#windScale').css({'stroke-width':lw*svg_scale()})
}

function capitalize(str) {
    var strVal = '';
    str = str.split(' ');
    for (var chr = 0; chr < str.length; chr++) {
        strVal += str[chr].substring(0, 1).toUpperCase() + str[chr].substring(1, str[chr].length) + ' '
    }
    return strVal
}

function show_only(what){
  //alert('show '+what);
  var ids="[id*="+what+"]";
  var names=['temp','salt','speed'];

//  if (document.getElementById('cbar').getSVGDocument()){
//    $(document.getElementById('cbar').getSVGDocument().getElementById('cbar_'+what)).css({'opacity':1});
//  }


  $(ids).css({'opacity':1});
  $('#radio'+capitalize(what)).prop('checked',1);

  // hide all others:
  for (var i = 0; i < names.length; i++) {
    if (names[i]!=what){
      $("[id*="+names[i]+"]").css({'opacity':0});
      //if (document.getElementById('cbar').getSVGDocument()){
      //  $(document.getElementById('cbar').getSVGDocument().getElementById('cbar_'+names[i])).css({'opacity':0});
      //}
    }

  }
}

// update on load or zoom:
function update_vars_OLD(){
  //change isobaths to show and lw according to zoom
  var zoom=map.getZoom();

  // isobaths and currents line width:
  var lwMax=0.7;
  if (zoom<=7){
    var lw=lwMax;
  }else{
    var lw=lwMax/Math.pow(2,zoom-7)
  }

  zoom = zoom<=7 ? 7:zoom;
  zoom = zoom>=9 ? 9:zoom;

  // isobaths and clabels:
  // hide all and show for current zoom:
  $("[id*=_bathy_]").css({'opacity':0});
  $("[id*=h_bathy_"+zoom+"]").css({"opacity":1,"stroke-width":lw});
  $("[id*=c_bathy_"+zoom+"]").css({"opacity":1});

  // currents:
  // hide all and show for current zoom if currents is checked:
  $("[id*=currents_]").css({'opacity':0});
  if($('input[id="checkboxCurrents"]:checked').length > 0){
    $("#currents_"+zoom).css({'opacity':1});
    $("[id*=currents_"+zoom+"]").children().css({"stroke-width":lw});
    // show scale:
    //$("#currents_"+zoom+"_scale").css({'opacity':1});
  }


  // currents key:
  var ob=document.getElementById('currents_'+zoom+'_scale');
  var L=ob.getBoundingClientRect()['width'];
  var p=seta(0,10,L,0);
  pts='';
  for (var i=0; i<p.length; i++){
    pts+=p[i][0]+','+p[i][1]+' ';
  }

  $('#currentsScale').attr('points',pts);
  // center arrow:
  var arrowStart=40-L/2;
  $('#currentsScale').attr('transform','scale(1) translate('+arrowStart+',0)');


  // wind key:
  var ob=document.getElementById('wind_'+zoom+'_scale');
  var L=ob.getBoundingClientRect()['width'];
  var p=seta2d(0,12,L,0);
  pts='';
  for (var i=0; i<p.length; i++){
    pts+=p[i][0]+','+p[i][1]+' ';
  }

  $('#windScale').attr('points',pts);
  // center arrow:
  var arrowStart=40-L/2;
  $('#windScale').attr('transform','scale(1) translate('+arrowStart+',0)');
}

  function add(A,B){
    return [A[0]+B[0],A[1]+B[1]]
  }
  function rem(A,B){
    return [A[0]-B[0],A[1]-B[1]]
  }
  function smul(s,A){
    return [s*A[0],s*A[1]]
  }
  function norm(A){
    return Math.sqrt(Math.pow(A[0],2)+Math.pow(A[1],2));
  }

function seta(x,y,u,v){
  var a=1./5*norm([u,v]);
  var Fi=20*Math.PI/180;
  var teta=Math.atan2(v,u);
  var fi=Math.PI-Fi+teta;
  var fii=Math.PI+Fi+teta;

  var P=[x,y];
  var P1=[x+u,y+v];
  var P2=[x+u+a*Math.cos(fi)/Math.cos(Fi),y+v+a*Math.sin(fi)/Math.cos(Fi)];
  var P3=[x+u+a*Math.cos(fii)/Math.cos(Fi),y+v+a*Math.sin(fii)/Math.cos(Fi)];
  return [P,P1,P2,P1,P3,P1]
}

function seta2d(x,y,u,v){

  var param1=2/3;
  var param2=1/3;
  var param3=1/3;
  var teta=45;

  var V=[u,v];
  var P=[x,y];
  var L=norm(V);
  var r=[u/L,v/L];
  var P4=add(P,smul(L,r));
  var Pi=add(P,smul(param1*L,r));
  if (v==0){
    var aux=Math.PI/2;
  }else{
    var aux=Math.atan(-u/v);
  }
  var ri=[Math.cos(aux),Math.sin(aux)];
  var PiP3=norm(rem(P4,Pi))*Math.tan(teta*Math.PI/180);
  var P3=add(Pi,smul(+PiP3,ri));
  var P5=add(Pi,smul(-PiP3,ri));
  var P1=add(P,smul(+PiP3*param2,ri));
  var P7=add(P,smul(-PiP3*param2,ri));
  var b=param3*norm(rem(P4,Pi));
  var bb=b/PiP3*(PiP3-norm(rem(P1,P)));
  var P2=add(P1,smul(param1*L+bb,r));
  var P6=add(P7,smul(param1*L+bb,r));
  return [P,P1,P2,P3,P4,P5,P6,P7,P]

}

function choose_riv(labLess,labMore){

  var curr=$('#river').attr('value').split(' ');
  if (labLess==null){
    labLess=curr[0];
  }

  if (labMore==null){
    labMore=curr[1];
  }

  var newv=labLess+' '+labMore;
  $('#river').attr('value',newv);

  $('[id*=chriv]').css({'background-color':''});
  $('#chriv_l_'+labLess).css({'background-color':'#9660bc'});
  $('#chriv_m_'+labMore).css({'background-color':'#9660bc'});

//    $(document.getElementById('river').getSVGDocument()).children().css({'opacity':0.2});
//    $(document.getElementById('river').getSVGDocument(),$("#river_0.25_0.25")).css({'opacity':1})
//    $(document.getElementById('river'),$('[id*=river_]')).css({'opacity':0});
//
//    $(document.getElementById('river'),$("[id*=river_025_025]")).css({'opacity':1});
//    $(document.getElementById('river'),$('#river_0.25_0.25')).css({'opacity':1});
//    $(document.getElementById('river').getSVGDocument().getElementById("river_025_025")).css({'opacity':1});
//   alert(document.getElementById('river').getSVGDocument().getElementById("river_025_025"));
//  return document.getElementById('river').getSVGDocument().getElementById("river_025_025")
//  $(ax).children().css({'opacity':1});
//  return $(document.getElementById('river').getSVGDocument().getElementById("river_200_025"))

  var labL=['025','050','100','200'];
  var labM=['000','025','050','100','200'];
  for (var i = 0; i < labL.length; i++) {
    for (var j = 0; j < labM.length; j++) {
      sid='river_'+labL[i]+'_'+labM[j];
      //console.log(sid);
      $(document.getElementById('river').getSVGDocument().getElementById(sid)).css({'opacity':0});
    }

  }

  var ax=document.getElementById('river').getSVGDocument().getElementById('river_'+labLess+'_'+labMore);
  if (ax){
    $(ax).css({'opacity':1});
  }
}

function after_svg_tasks(){

  if (Init){
    Init=0;

    // update default currents colour:
    $('#inputCurrColor').val(config['currents_color']);
    $('#inputCurrColor').css({'background-color':'#'+config['currents_color'],'color':'white'});
    change_currents_color(config['currents_color']);

    // update default uv colour:
    $('#inputWndColor').val(config['wind_color']);
    $('#inputWndColor').css({'background-color':'#'+config['wind_color'],'color':'white'});
    change_wind_color(config['wind_color']);

    // update default isobaths colour:
    $('#input_isobaths_color').val(config['isobaths_color']);
    $('#input_isobaths_color').css({'background-color':'#'+config['isobaths_color']});
    change_isobaths_color(config['isobaths_color']);

    // add the colorbars:
    load_colorbars();

    // show default field:
    show_only(config['default_field']);

    // show isobaths:
    $('#checkboxBathy').prop('checked',1);
    show_hide_isobaths();

    rivDefaults=["050","050"];
    choose_riv(rivDefaults[0],rivDefaults[1]);
  }

  // update ...
}

function change_currents_color(cor){
  //uv arrows:
  $("[id*=currents_]").children().css({'stroke':cor});
  //uv scale arrow:
  $('#currentsScale').css({'stroke':cor});
}

function change_wind_color(cor){
  //uv arrows:
  $("[id*=wind_]").children().css({'stroke':cor});
  //uv scale arrow:
  $('#windScale').css({'stroke':cor});
}

function change_isobaths_color(cor){
  $("[id*=h_bathy]").children().css({'stroke':cor}); // lines
  $("[id*=clab1_bathy]").css({'fill':cor});  // texts
  $("[id*=clab1_bathy]").children().css({'fill':cor});  // texts
  $("[id*=clab1_bathy]").children().children().css({'fill':cor});  // texts

  $("[id*=clab2_bathy]").children('defs').children('circle').css({'fill':cor});
  // need to update radius so that fill update works!!! why?
  var zoom=get_zoom();
  var rr=$("[id*=clab2_bathy_"+zoom+"]").children('defs').children('circle').attr('r');
  $("[id*=clab2_bathy_"+zoom+"]").children('defs').children('circle').attr('r',rr);
}


function load_colorbars(){

  file='colorbars.svg';
  function readTextFile(file){
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function (){
        if(rawFile.readyState === 4)
        {
            if(rawFile.status === 200 || rawFile.status == 0)
            {
                var allText = rawFile.responseText;
                $('#cbarDiv').html(allText);
            }
        }
    }
    rawFile.send(null);
  }

  readTextFile(file);
  $('#colorbars').css({'width':350,'height':55});
};


$(document).ready(function() {
  //alert($('svg').ready);
  var d = new Date();
  var strDate = d.getFullYear()+''+(d.getMonth()+1)+''+d.getDate()+''+d.getHours();
  $('#now').html(strDate);

  //load_colorbars();

  // set default field to show:
//   show_only(config['default_field']); // svg may not be ready yet !

  show_dialog('vars_panel');
});

function update_time(){
  var d = new Date();
  $('#now').html('www');
}

    </script>


<div id="date_selector" class="menu">
	<div id="previous" class="item_selector"><i class="fa fa-cog fa-lg"></i></div>
	<div id="now" class="item_selector"></div>
	<div id="next" class="item_selector"><i class="fa fa-cog fa-lg"></i></div>
</div>

<div id="vars_btn" class="menu" onclick="show_dialog('vars_panel')"><i class="fa fa-list-alt fa-lg"></i></div>
<div id="vars_panel" class="menu">

<!--<div id="first_menu" class="menu">-->
	<form>
          <div style='background-color:#dce7f7;border-radius: 4px;'>
	  <strong>fields:</strong><br>
	  <input id="radioSalt"  type="radio" name="field" value="salt"  style='cursor: pointer' onclick='show_only("salt")'><label style='cursor: pointer'  for=radioSalt>Salinity</label><br>
	  <input id="radioTemp"  type="radio" name="field" value="temp"  style='cursor: pointer' onclick='show_only("temp")'><label style='cursor: pointer'  for=radioTemp>Temperature</label><br>
	  <input id="radioSpeed" type="radio" name="field" value="speed" style='cursor: pointer' onclick='show_only("speed")'><label style='cursor: pointer' for=radioSpeed>Speed</label><br>
	  <hr>
	  <strong>overlay:</strong><br>
	  <input id="checkboxCurrents" type="checkbox"  style='cursor: pointer' onclick='show_hide_vfield("currents")'>currents<br>
	  <input id="checkboxWind"     type="checkbox"  style='cursor: pointer' onclick='show_hide_vfield("wind")'>wind<br>
          </div>
	  <strong>external:</strong><br>
	  <input id="checkboxRadar"    type="checkbox"  style='cursor: pointer' onclick='show_hide("radar")'>radar (todo)<br>
	  <input id="checkboxBuoys"    type="checkbox"  style='cursor: pointer' onclick='show_hide("buoys")'>buoys (todo)<br>
	  <hr>
	  <strong>aux:</strong><br>
	  <input id="checkboxBathy"    type="checkbox"  style='cursor: pointer' onclick='show_hide_isobaths()'>isobaths<br>
	  <input id="checkboxRiver"    type="checkbox"  style='cursor: pointer' onclick='show_hide_river()'>river
	</form>
</div>

<!--<div id='vscales' style='border: 0px solid red; position: absolute; left: 230px; top: 410px; width:180px; height: 35px;'>
<div id='currentsSvgScale' style='border: 0px solid red; position: absolute; left: 350px; top: 410px; width:80px; height: 35px; background-color: white; opacity:0.8; border-radius: 7px; box-shadow: 0px 0px 7px #888888;'>
-->

<div id='currentsSvgScale0' style='position: absolute; left: 320px; top: 410px; width:80px; height: 35px; border: 0px solid green; background-color: white; opacity:0.8; border-radius: 7px; box-shadow: 0px 0px 7px #888888;'>
</div>
<div id='currentsSvgScale'  style='position: absolute; left: 320px; top: 410px; width:80px; height: 35px; border: 0px solid red;'>
<svg id='uvSvgScale' width="100%">
  <polygon id='currentsScale' points="00,10 100,10 90,5 100,10 90,15 100,10"
        style="stroke:black;stroke-width:1"
        transform="scale(1) translate(5,0)"/>
  <text id='currentsScaleLabel' x="40" y="30" style='fill:black' font-family="Helvetica" font-size="11" text-anchor='middle'>
        0.5 m s <tspan baseline-shift = "super">-1</tspan>
  </text>
</svg>
</div>

<!--<div id='windSvgScale' style='border: 0px solid red; position: absolute; left: 300px; top: 410px; width:80px; height: 35px; background-color: white; opacity:0.8; border-radius: 7px; box-shadow: 0px 0px 7px #888888;'>
<div id='windSvgScale' style='float: right;border: 0px solid red; width:80px; height: 35px; background-color: white; opacity:0.8; border-radius: 7px; box-shadow: 0px 0px 7px #888888;'>
-->
<div id='windSvgScale0' style='position: absolute; left: 230px; top: 410px; width:80px; height: 35px; border: 0px solid green; background-color: white; opacity:0.8; border-radius: 7px; box-shadow: 0px 0px 7px #888888;'>
</div>
<div id='windSvgScale'  style='position: absolute; left: 230px; top: 410px; width:80px; height: 35px; border: 0px solid red;'>
<svg id='uvwndSvgScale' width="100%">
  <polygon id='windScale' points="00,10 100,10 90,5 100,10 90,15 100,10"
        style="stroke:black;stroke-width:1; fill:white"
        transform="scale(1) translate(5,0)"/>
  <text id='windScaleLabel' x="40" y="33" style='fill:black' font-family="Helvetica" font-size="11" text-anchor='middle'>
        5 m s <tspan baseline-shift = "super">-1</tspan>
  </text>
</svg>
</div>
<!--</div>-->

<div id='cbarDiv0' style='position: absolute; width:350px; height: 55px; top: 400px; left: 420px; border: 0px solid green; background-color: white; opacity:0.8; border-radius: 7px; box-shadow: 0px 0px 7px #888888;'></div>
<div id='cbarDiv'  style='position: absolute; width:350px; height: 55px; top: 400px; left: 420px; border: 0px solid red'></div>
<!--<div id='cbarDiv' style='position: absolute; top: 400px; left: 450px; border: 1px solid red'>
  <object id='cbar' data="colorbars.svg" type="image/svg+xml" style='width:320px'></object>
</div>
-->

<div id='rivDiv' style='position: absolute; top: 240px; left: 520px; border: 0px solid red; opacity:0; background-color: white;  border-radius: 7px; box-shadow: 0px 0px 7px #888888;'>
   <div style='cursor: pointer; font-size:12px;'>
     &nbsp;
     <div style='float:left; padding-left:5px; padding-top:2px;'>
       <div id='chriv_l_200' onmouseover=this.style.color='blue' onmouseout=this.style.color='black'  style='display:inline' onclick='choose_riv("200",null)'>-2y</div>
       <div id='chriv_l_100' onmouseover=this.style.color='blue' onmouseout=this.style.color='black' style='display:inline' onclick='choose_riv("100",null)'>-1y</div>
       <div id='chriv_l_050' onmouseover=this.style.color='blue' onmouseout=this.style.color='black' style='display:inline' onclick='choose_riv("050",null)'>-&frac12;y</div>
       <div id='chriv_l_025' onmouseover=this.style.color='blue' onmouseout=this.style.color='black' style='display:inline' onclick='choose_riv("025",null)'>-&frac14;y</div>
     </div>

     <div style='float:right; padding-right:5px; padding-top:2px'>
       <div id='chriv_m_000' onmouseover=this.style.color='blue' onmouseout=this.style.color='black' style='display:inline' onclick='choose_riv(null,"000")'>+0y</div>
       <div id='chriv_m_025' onmouseover=this.style.color='blue' onmouseout=this.style.color='black' style='display:inline' onclick='choose_riv(null,"025")'>+&frac14;y</div>
       <div id='chriv_m_050' onmouseover=this.style.color='blue' onmouseout=this.style.color='black' style='display:inline' onclick='choose_riv(null,"050")'>+&frac12;y</div>
       <div id='chriv_m_100' onmouseover=this.style.color='blue' onmouseout=this.style.color='black' style='display:inline' onclick='choose_riv(null,"100")'>+1y</div>
       <div id='chriv_m_200' onmouseover=this.style.color='blue' onmouseout=this.style.color='black' style='display:inline' onclick='choose_riv(null,"200")'>+2y</div>
     </div>

   </div>
  <object value='050 050' id='river' data="riv.svg" type="image/svg+xml" style='width:250px'></object>
</div>

<script>
/*function show_config(){
  var disp=$('#conf_panel').css('display');
  if (disp=='none'){
    $('#conf_panel').css({'display':'block'});
  }else{
    $('#conf_panel').css({'display':'none'});
  }
}

function show_webservice(){
  var disp=$('#webservice_panel').css('display');
  if (disp=='none'){
    $('#webservice_panel').css({'display':'block'});
  }else{
    $('#webservice_panel').css({'display':'none'});
  }
}
*/
function show_dialog(name){
  var ob=$('#'+name);
  var disp=ob.css('display');
  if (disp=='none'){
    ob.css({'display':'block'});
  }else{
    ob.css({'display':'none'});
  }
}

function webservice(vname){
  if (vname=='salt'){
//    alert('here!');
    window.open('/data/thredds/bathy', '_blank');
//    $("<a href='/data/thredds/bathy' target='_blank'></a>").click();
  }
}

</script>
<div id="conf_btn" class="menu" onclick="show_dialog('conf_panel')"><i class="fa fa-cog fa-lg"></i></div>
<div id="conf_panel" class="menu" >
  <div style="margin:5px;">
    Currents color:
    <input value='ffffff' id='inputCurrColor' class="jscolor {closable:true,closeText:'ok'}" onchange="change_currents_color(this.jscolor)" style="width:50px;float:right;font-size:10px; border:1px solid black">
  </div>

  <div style="margin:5px;">
    Wind color: <input value='ffffff' id='inputWndColor' class="jscolor {closable:true,closeText:'ok'}" onchange="change_wind_color(this.jscolor)" style="width:50px;float:right;font-size:10px; border:1px solid black">
  </div>

  <div style="margin:5px;">
    Isobaths color: <input value='ffffff' id='input_isobaths_color' class="jscolor {closable:true,closeText:'ok'}" onchange="change_isobaths_color(this.jscolor)" style="width:50px;float:right;font-size:10px; border:1px solid black">
  </div>

  <br>
  <button style="margin:5px;" type="button" class="btn" onclick="show_dialog('conf_panel')">done</button>
</div>

<div id='webservice_btn' class='menu' onclick="show_dialog('webservice_panel')"><i class="fa fa-rocket fa-lg"></i></div>
<div id="webservice_panel" class="menu" >
  <div style="margin:5px; float: right; font-weight: bold"> 2016-10-20 03h</div><br>
  <table border=0>
    <tr>
      <td class='wsvar' onclick='webservice("salt")'>salinity</td>
      <td class='wsvar'>temperature</td>
    </tr>
    <tr>
      <td class='wsvar'>speed</td>
      <td class='wsvar'>currents</td>
    </tr>
    <tr>
      <td class='wsvar'>wind</td>
      <td class='wsvar'>bathy</td>
    </tr>
  </table>

  <div style='float:right'>
  stride:
  <select name="select">
    <option value="1">1</option> 
    <option value="2" selected>2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
  </select>
  </div>

  <br>
  <button style="margin:5px;" type="button" class="btn" onclick="show_dialog('webservice_panel')">done</button>
</div>

<div id="download_btn" class="menu" onclick="show_dialog('download_panel')"><i class="fa fa-download fa-lg"></i></div>
<div id="download_panel" class="menu" >
    download gnome ... TODO
    <br><br><br>
    <button style="margin:5px;" type="button" class="btn" onclick="show_dialog('download_panel')">done</button>
</div>

</body>
</html>
